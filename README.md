# 🍽️ Lunch Chooser

チームのランチ場所を効率的に決定するWebアプリケーション

## 🌐 公開サイト

**URL**: https://ganta9.github.io/lunch-chooser/

## 概要

Lunch Chooserは、チームメンバーがWebブラウザを通じて昼食場所を決定できるアプリケーションです。Google Sheetsと連携し、条件に基づいて重み付けランダム選択し、週次でジャンルの重複を避ける機能を提供します。

## 🚀 主な機能

- 🎯 **条件ベース選択**: 近場・人数・ラーメン除外条件での絞り込み
- ⭐ **重み付け選択**: 星評価による重み付けランダム選択
- 📅 **週次ジャンル管理**: 月〜金で同ジャンル重複を防止
- 👤 **お一人様モード**: 履歴を考慮しない個人利用機能
- 🔄 **スマートやり直し**: 同条件での再選択機能
- 🆕 **新規開拓**: 外部リンク付き店舗探索機能
- 📊 **詳細情報表示**: メモ・場所・URL情報対応
- 💾 **共有履歴管理**: Google Apps Script連携
- 🔒 **エンタープライズ級セキュリティ**: CSP・XSS防御・A-評価達成
- 🎨 **フルスクリーンローディング**: 直感的なUI/UX

## 📖 使い方

1. Webブラウザで公開サイトにアクセス
2. 条件を選択
   - **ラーメン除外**: ラーメン店を候補から除外（デフォルトON）
   - **近場の店舗に限定**: 近場の店舗のみに絞り込み
   - **4人以上入れる店舗に限定**: 大人数対応店舗のみ
   - **履歴を考慮しない**: お一人様モード（ジャンル重複チェックなし）
3. 「ランチを決める！」ボタンをクリック
4. 結果を確認
   - **通常店舗**: 評価・メモ・場所・URL情報を表示
   - **新規開拓**: 外部リンクボタン（地図・食べログ）を表示
5. やり直し（同条件で再選択）または確定
6. 確定後、共有履歴に記録（お一人様モードは除く）

## 🏗️ プロジェクト構造

```
lunch-chooser/
├── 📄 設定・ドキュメント
│   ├── README.md              # このファイル
│   ├── DEPLOY.md              # デプロイ手順
│   ├── SECURITY_SETUP.md      # セキュリティ設定
│   ├── .gitignore            # Git除外設定
│   ├── config.js.template    # 設定テンプレート
│   └── .env.template         # 環境変数テンプレート
│
├── 🌐 Webアプリケーション
│   ├── index.html            # メインページ
│   ├── style.css             # スタイルシート
│   ├── script.js             # アプリロジック
│   └── config.js             # 設定ファイル（Git除外）
│
├── 📊 データ・ドキュメント
│   ├── data/
│   │   └── restaurants.json  # 参考用店舗データ
│   ├── docs/
│   │   ├── spec.md           # 要件・仕様書
│   │   ├── fails.md          # 失敗事例・バグ記録
│   │   └── google-apps-script-setup.md
│   └── google-apps-script.js # Google Apps Script
│
├── 🚀 CI/CD
│   ├── .github/workflows/
│   │   └── deploy.yml        # GitHub Actions
│   └── build.sh              # ビルドスクリプト
│
└── 🧪 テスト（予定）
    └── test/
```

## 🛠️ 技術仕様

### フロントエンド
- **HTML5** + **CSS3** + **ES6 JavaScript**
- **レスポンシブデザイン**（PC・スマートフォン対応）
- **Progressive Web App** 対応

### バックエンド・データ管理
- **Google Sheets API** - 店舗データ管理
- **Google Apps Script** - サーバーサイド処理
- **ローカルストレージ** - クライアント履歴管理

### デプロイ・CI/CD
- **GitHub Actions** - 自動ビルド・デプロイ
- **GitHub Pages** - 静的サイトホスティング
- **環境変数管理** - GitHub Secrets

### セキュリティ
- **APIキー** - 環境変数で管理
- **CORS対応** - クロスオリジン制御
- **機密情報除外** - .gitignore設定

## 📋 開発状況

### ✅ Phase 1: 基本実装（完了）
- [x] HTML/CSS/JavaScript実装
- [x] 条件フィルタリング機能
- [x] 重み付けランダム選択
- [x] やり直し・確定機能

### ✅ Phase 2: 履歴管理（完了）
- [x] ローカルストレージ履歴管理
- [x] 週次ジャンル重複チェック
- [x] 今週利用状況表示

### ✅ Phase 3: 高度な機能（完了）
- [x] 星評価による重み付け
- [x] 新規開拓選択肢
- [x] 設定調整機能
- [x] レスポンシブデザイン

### ✅ Phase 4: Google Sheets連携（完了）
- [x] Google Sheets API統合
- [x] リアルタイムデータ取得
- [x] Google Apps Script連携

### ✅ Phase 5: セキュリティ強化（完了）
- [x] APIキー環境変数化
- [x] GitHub Actions CI/CD
- [x] セキュアなデプロイメント

### ✅ Phase 6: 最適化・安定化（完了）
- [x] config.js生成問題の完全解決
- [x] 並列読み込みによるパフォーマンス最適化
- [x] エラーハンドリング・UI安定性強化
- [x] 共有履歴データ整合性の確保
- [x] JSONP競合状態問題の解決

### ✅ Phase 7: 同期強化・重複防止（完了）
- [x] 30秒タイムアウトで共有履歴同期強化
- [x] 重複選択防止システム実装
- [x] 同期失敗時の視覚的警告システム
- [x] ユーザー確認ダイアログによる安全性向上

### ✅ Phase 8: セキュリティ強化（完了）
- [x] Content Security Policy (CSP) 実装
- [x] 入力データ検証強化とXSS防止
- [x] CORS設定の厳密化と追加ヘッダー
- [x] 包括的セキュリティ分析とA-評価達成

### 🔄 Phase 9: 運用・保守（継続中）
- [x] 包括的失敗事例ドキュメント作成
- [x] トラブルシューティングガイド整備
- [x] セキュリティ分析報告書作成
- [ ] 長期運用での安定性監視

## 🔧 開発・デプロイ

### ローカル開発
```bash
# リポジトリクローン
git clone https://github.com/ganta9/lunch-chooser.git
cd lunch-chooser

# 設定ファイル作成
cp config.js.template config.js
# config.js を編集して実際の値を設定

# ローカルサーバー起動
python3 -m http.server 8000
```

### 本番デプロイ
詳細は [DEPLOY.md](DEPLOY.md) を参照

## 📚 ドキュメント

- 📖 [デプロイ手順](DEPLOY.md)
- 🔒 [セキュリティ設定](SECURITY_SETUP.md)
- 🛡️ [セキュリティ分析報告書](docs/security-analysis.md)
- 📋 [要件・仕様書](docs/spec.md)
- 🚨 [失敗事例・バグ記録](docs/fails.md)
- 🔧 [Google Apps Script設定](docs/google-apps-script-setup.md)

## 🐛 サポート・貢献

- **バグ報告**: [GitHub Issues](https://github.com/ganta9/lunch-chooser/issues)
- **機能要望**: GitHub Issues で提案
- **セキュリティ問題**: リポジトリメンテナーに直接連絡

## 📄 ライセンス

MIT License - 詳細は [LICENSE](LICENSE) ファイルを参照

## 🔒 セキュリティ

このプロジェクトは以下のセキュリティ対策を実装しています：

- ✅ APIキーの環境変数管理
- ✅ 機密情報のGit除外
- ✅ GitHub Actionsでの自動デプロイ
- ✅ CORS対応とAPI制限

セキュリティ問題を発見した場合は、公開せずにメンテナーに直接報告してください。

---

**作成日**: 2024-08-15  
**最終更新**: 2025-08-16  
**バージョン**: 5.0（UX最適化版）  
**開発**: Claude Code Team

**主要改善点（v5.0）**:
- 🎯 **新機能追加**: ラーメン除外・お一人様モード・詳細情報表示
- 🆕 **新規開拓刷新**: 外部リンク付き専用UI（地図・食べログ連携）
- 🔄 **UX大幅改善**: スマートやり直し・フルスクリーンローディング
- ⚙️ **設定最適化**: 直感的な星評価設定・スタイリッシュUI

**累積改善（v4.2→v5.0）**:
- 🎨 **UI/UX**: 直感的インターフェースと視覚的改善
- 📊 **データ拡張**: メモ・場所・URL情報対応
- 🛡️ **セキュリティ維持**: A-評価のエンタープライズ級防御継続
- 🚀 **パフォーマンス**: ローディング表示とボタン制御改善